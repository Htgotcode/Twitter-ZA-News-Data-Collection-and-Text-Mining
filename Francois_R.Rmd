---
title: "R Notebook"
output: html_notebook
---
Importing Packages
```{r}
install.packages("tidytext")
install.packages("tidyverse")
install.packages("sentimentr")
install.packages("textdata")
install.packages("stringi")
install.packages("rtweet")
install.packages("quanteda")
install.packages("topicmodels")
install.packages("reshape2")
```

Importing Libraries
```{r}
library(tidytext)
library(tidyverse)
library(textdata)
library(sentimentr)
library(stringr)
library(stringi)
```
Importing data
```{r}
media_agency_df <- read_csv("data_in/media_agency_tweets.csv")
media_agency_df <- media_agency_df[ , colSums(is.na(media_agency_df)) < nrow(media_agency_df)]

```

Wrangeling data
```{r}
picky_mtdf<- media_tweets_df %>%
  select(screen_name,text) %>%
   unnest_tokens("word", text)

data(stop_words)

picky_mtdf <- picky_mtdf %>%
  anti_join(stop_words)

picky_mtdf%>%
  filter(!(word=="https"|
             word=="rt"|
             word=="t.co"|
             word=="amp")) %>%
  count(word, sort=TRUE)
```

```{r}
set_tweets <- media_tweets_df %>%
  select(text)
set_tweets <- unlist(strsplit(set_tweets, "\\."))
set_tweets[grep(pattern = "Covid-19", text, ignore.case = T)]
filtered_tweets<- media_tweets_df[grep("covid", media_tweets_df$text), ignore.case = TRUE]
```

```{r}
#cleaning




mytext<- media_agency_df%>%
  select(text) 
mytext <- get_sentences(mytext)
sentiment(mytext)
```
Reasons for the media sources chosen:
News 24 : Recognized by APP Annie (App Annie is the standard in app analytics and app market data) as the most known South African internet media source. (Chinese Academy of Cyberspace Studiespublisher=Springer (15 September 2018). World Internet Development Report 2017: Translated by Peng Ping. p. 203. ISBN 9783662575246. OCLC 1052766508.)

Times Live : South Africa's second-biggest news website, published by Arena Holdings (Times Live website)

EWN : Not much info but it can be considered to be popular because it originated from 2 radio stations (KFM and CapeTalk)

eNCA: Not much info but seems popular. Used to E News from TV channel. Might not be as trustworthy as there has been complaints about racism recently.

SABC: National news company with government ties. reaches a wide variety of viewers in different languages.

Justify why we use these agencies. Size? Reputable? unbias?

#Kyles Code
Libraries
```{r}
library(rtweet)
library(ggplot2)
library(tidyr)
library(dplyr)
library(tidytext)
library(stringr)
library(scales)
library(readr)
library(lubridate)
library(topicmodels)
library(quanteda)
library(reshape2)
```




```{r}
media_agency_df <- read_csv("data_in/media_agency_tweets.csv")

tidy_covid_media_df <- media_agency_df %>%
  #filter(str_detect(text, fixed(covid_dictionary, ignore_case = TRUE))) %>%
  filter(!str_detect(text, "^RT")) %>%
  mutate(text = gsub(" ?(f|ht)tp(s?)://(.*)[.][a-z]+", "", text)) %>%
  unnest_tokens(word, text, token = "tweets") %>%
  filter(!word %in% stop_words$word,
         !word %in% str_remove_all(stop_words$word, "'"),
         str_detect(word, "[a-z]"),
         !(word =="#sabcnews" |
             word =="#enca" |
             word =="https" |
             word =="#dstv403" |
             word =="t.co" |
             word =="rt" |
             word =="amp"))
tidy_matrix <- tidy_covid_media_df %>% count(screen_name, word) %>% cast_dfm(screen_name, word, n)

 
media_lda <- LDA(tidy_matrix, k = 12, control = list(seed = 1234))
media_lda
media_topics <- tidy(media_lda, matrix = "beta")
media_topics
media_top_terms <- media_topics %>%
group_by(topic) %>%
slice_max(beta, n = 10) %>%
ungroup() %>%
arrange(topic, -beta)
 

media_top_terms %>%
mutate(term = reorder_within(term, beta, topic)) %>%
ggplot(aes(beta, term, fill = factor(topic))) +
geom_col(show.legend = FALSE) +
facet_wrap(~ topic, scales = "free") +
scale_y_reordered()
```
Vader stuff
```{r}
vader_data<- read_csv("data_in/vader_df.csv")
```

